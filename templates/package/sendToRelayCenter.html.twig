{% extends 'base.html.twig' %}

{% block title %}Ajout d'un colis{% endblock %}

{% block body %}
<div class="container d-flex justify-content-center align-items-center flex-column">
    <h1 class="mb-4">{% block h1 %}Ajout d'un colis{% endblock %}</h1>

    <div class="w-50">
        {{ form_start(form) }}

        <div class="mb-3">
            {{ form_row(form.weight, {
                'label': 'Poids',
                'attr': {'class': 'form-control'}
            }) }}
        </div>

        <div class="mb-3">
            {{ form_row(form.volume, {
                'label': 'Volume',
                'attr': {'class': 'form-control'}
            }) }}
        </div>

        <div class="mb-3">
            {{ form_row(form.relayCenter, {
                'label': 'Sélectionnez un point relais',
                'attr': {'class': 'form-control'}
            }) }}
        </div>

        <div class="mb-3">
            {{ form_row(form.locker, {
                'label': 'Sélectionnez un casier',
                'attr': {'class': 'form-control'}
            }) }}
        </div>

        <div class="text-center mt-3">
            {{ form_row(form.submit, {'attr': {'class': 'btn btn-primary'}}) }}
        </div>

        {{ form_end(form) }}
    </div>

    <script>
        document.getElementById('package_locker').innerHTML = '';
        var option = document.createElement('option')
        option.textContent = "Sélectionnez un casier";
        document.getElementById('package_locker').appendChild(option);

        document.addEventListener('DOMContentLoaded', function() {
            var pointRelaisSelect = document.getElementById('package_relayCenter');

            pointRelaisSelect.addEventListener('change', function() {
                var pointRelaisId = this.value;

                fetch('/api/relay-center/available-lockers/' + pointRelaisId)
                    .then(function(response) {
                        return response.json();
                    })
                    .then(function(data) {
                        var casierSelect = document.getElementById('package_locker');
                        casierSelect.innerHTML = '';
                        var option = document.createElement('option')
                        option.textContent = "Sélectionnez un casier";
                        casierSelect.appendChild(option);

                        data.forEach(function(casier) {
                            var option = document.createElement('option');
                            option.value = casier.id;
                            option.textContent = casier.lockerNumber;
                            casierSelect.appendChild(option);
                        });
                    });
            });
        });
    </script>
</div>
{% endblock %}
